#!/usr/bin/env groovy

def installNPM(){
	def nodeHome = tool 'nodejs-10.9.0'
	env.PATH="${env.PATH}:${nodeHome}/bin"
	sh "npm install yarn"
	sh "npm install vsce"
	sh "npm version"
}

def EXT_path = "node-debug"
timeout(120) {
	node("${node}"){ stage "Build ${EXT_path}"
		checkout([$class: 'GitSCM',
			branches: [[name: "${branchToBuildPlugin}"]],
			doGenerateSubmoduleConfigurations: false,
			poll: true,
			extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: "${EXT_path}"]],
			submoduleCfg: [],
			userRemoteConfigs: [[url: "https://github.com/microsoft/vscode-node-debug2"]]])
		sh "cd ${EXT_path} && npm install && vsce package"

		echo "build finished"

		archiveArtifacts artifacts: 'node-debug/*.vsix', fingerprint: true
	}
}
