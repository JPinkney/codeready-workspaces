#!/usr/bin/env groovy

timeout(120) {
	node("${node}"){ stage "Build ${extensionFolder}"
		checkout([$class: 'GitSCM',
			branches: [[name: "${branchToBuildPlugin}"]],
			doGenerateSubmoduleConfigurations: false,
			poll: true,
			extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: "${extensionFolder}"]],
			submoduleCfg: [],
			userRemoteConfigs: [[url: "${clonePath}"]]])
		sh "cd ${extensionFolder} && sudo npm install -g vsce --verbose && npm install --verbose && vsce package"

		echo "build finished"

		archiveArtifacts artifacts: '${extensionFolder}/*.vsix', fingerprint: true
	}
}
